SELECT * FROM (
SELECT 
      0 AS TIPOQUERY,
     	(CASE D2_FILIAL
            WHEN '01' THEN '010101'
            ELSE NULL
         END) CNPJORIGEMDADOS,
      CONCAT (D2_FILIAL,
            D2_DOC,
            D2_SERIE,
            D2_EMISSAO,
            D2_CLIENTE,
            D2_LOJA,
            D2_ITEM) ID,
      D2_DOC,
      D2_SERIE,
      D2_EMISSAO,
      D2_PEDIDO,
      CASE D2_TIPO
         WHEN 'N' THEN '1'
         WHEN 'D' THEN '0'
         WHEN 'P' THEN '2'
         WHEN 'I' THEN '2'
         WHEN 'C' THEN '1'
         WHEN 'B' THEN '2'
         ELSE NULL
      END TIPO,
      A1_CGC,
      CONCAT (D2_CLIENTE,D2_LOJA) IDCLIENTE,
      NULL IDNOTAFISCALORIGEM,
      NULL NOTAFISCALORIGEM,
      D2_COD,
      B1_DESC,
      B1_COD,
      D2_UM,
      D2_QUANT,
      D2_PRCVEN,
      D2_VALBRUT,
      D2_DESC,
      D2_TOTAL,
      D2_CF,
      B.R_E_C_N_O_,
      B.D_E_L_E_T_ DELETADO,
      CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGI, 16, 1)) - 50)), '19960101'), 103) AS DATA_INCLUSAO,
      CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGA, 16, 1)) - 50)), '19960101'), 103) AS DATA_ALTERACAO
FROM SD2010 B WITH (NOLOCK)
INNER JOIN SF2010 X WITH (NOLOCK) ON X.F2_DOC = B.D2_DOC
AND X.F2_SERIE = B.D2_SERIE
AND X.F2_FILIAL = B.D2_FILIAL
AND X.F2_CLIENTE = B.D2_CLIENTE
AND X.F2_LOJA = B.D2_LOJA
AND X.F2_EMISSAO = B.D2_EMISSAO
AND X.D_E_L_E_T_ = ''
INNER JOIN SA1010 M WITH (NOLOCK) ON M.A1_COD = B.D2_CLIENTE
AND M.D_E_L_E_T_ = ''
INNER JOIN SB1010 U WITH (NOLOCK) ON U.B1_COD = B.D2_COD
AND U.D_E_L_E_T_ = ''
WHERE (B.D2_USERLGI <> ' '
  AND (
            (1 =1 AND (CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGI, 16, 1)) - 50)), '19960101'), 112) >= {START_DATE}))
            OR
            (1 =1 AND (CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGA, 16, 1)) - 50)), '19960101'), 112) >= {START_DATE}))
      )
)
UNION ALL
SELECT      	
      1 AS TIPOQUERY,
      (CASE D1_FILIAL
            WHEN '01' THEN '010101'
            ELSE NULL
         END) CNPJORIGEMDADOS,
       CONCAT (D1_FILIAL,
               D1_DOC,
               D1_SERIE,
               D1_EMISSAO,
               D1_FORNECE,
               D1_LOJA,
               D1_ITEM) ID,
      D1_DOC,
      D1_SERIE,
      D1_EMISSAO,
      D1_PEDIDO,
      CASE D1_TIPO
            WHEN 'N' THEN '1'
            WHEN 'D' THEN '0'
            WHEN 'P' THEN '2'
            WHEN 'I' THEN '2'
            WHEN 'C' THEN '1'
            WHEN 'B' THEN '2'
            ELSE NULL
            END TIPO,
      A1_CGC,
      CONCAT (D1_FORNECE,
            D1_LOJA) IDCLIENTE,
      CONCAT (F2_FILIAL,
            F2_DOC,
            F2_SERIE,
            F2_CLIENTE,
            F2_LOJA,
            F2_EMISSAO,
            F2_CHVNFE,
            F2_IDNF) IDNOTAFISCALORIGEM,
            D1_NFORI AS NOTAFISCALORIGEM,
      D1_COD,
      B1_DESC,
      B1_COD,
      D1_UM,
      D1_QUANT,
      null D1_PRCVEN,
      D1_VUNIT,
      D1_DESC,
      D1_TOTAL,
      D1_CF,
      B.R_E_C_N_O_,
      B.D_E_L_E_T_ DELETADO,
      CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D1_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D1_USERLGI, 16, 1)) - 50)), '19960101'), 103) AS DATA_INCLUSAO,
      CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D1_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D1_USERLGA, 16, 1)) - 50)), '19960101'), 103) AS DATA_ALTERACAO
FROM SD1010 B WITH (NOLOCK)
INNER JOIN SA1010 X WITH (NOLOCK) ON X.A1_COD = B.D1_FORNECE
AND X.A1_LOJA = B.D1_LOJA
AND X.D_E_L_E_T_ = ''
INNER JOIN SB1010 W WITH (NOLOCK) ON W.B1_COD = B.D1_COD
AND W.D_E_L_E_T_ = ''
INNER JOIN SF2010 H WITH (NOLOCK) ON H.F2_FILIAL = B.D1_FILIAL
AND H.F2_DOC = B.D1_NFORI
AND H.F2_SERIE = B.D1_SERIORI
AND H.D_E_L_E_T_ = ''
INNER JOIN SF1010 Q WITH (NOLOCK) ON Q.F1_DOC = B.D1_DOC
AND Q.F1_SERIE = B.D1_SERIE
AND Q.F1_FILIAL = B.D1_FILIAL
AND Q.F1_FORNECE = B.D1_FORNECE
AND Q.F1_LOJA = B.D1_LOJA
AND Q.F1_EMISSAO = B.D1_EMISSAO
AND Q.D_E_L_E_T_ = ''
WHERE (B.D1_USERLGI <> ' '
  AND (
            (1 =1 AND (CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D1_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D1_USERLGI, 16, 1)) - 50)), '19960101'), 112) >= {START_DATE}))
            OR
            (1 =1 AND (CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D1_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D1_USERLGA, 16, 1)) - 50)), '19960101'), 112) >= {START_DATE}))
      )
      AND D1_NFORI <> ' '
)
)  ORDER BY TIPOQUERY ASC, R_E_C_N_O_ ASC