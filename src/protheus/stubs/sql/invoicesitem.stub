SELECT 
      D2_FILIAL,
      F2_FILIAL,
      A1_FILIAL,
      B1_FILIAL,
      CONCAT (D2_FILIAL, D2_DOC, D2_SERIE, D2_EMISSAO, D2_CLIENTE, D2_LOJA, D2_ITEM) id,
      D2_DOC,
      D2_SERIE,
      D2_EMISSAO,
      D2_PEDIDO,
      D2_TIPO,
      A1_CGC,
      CONCAT (D2_CLIENTE, D2_LOJA) idCliente,
      CONCAT (F2_SDOCORI, '-', F2_NFORI) notaFiscalOrigem,
      D2_COD,
      B1_DESC,
      B1_COD,
      D2_UM,
      D2_QUANT,
      D2_PRCVEN,
      D2_VALBRUT,
      D2_DESC,
      D2_TOTAL,
      D2_CF,
      B.R_E_C_N_O_,
      B.D_E_L_E_T_ DELETADO_SD2,
      CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGI, 16, 1)) - 50)), '19960101'), 101) AS DATA_INCLUSAO,
      CONVERT(VARCHAR, DATEADD(DAY, ((ASCII(SUBSTRING(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGA, 16, 1)) - 50)), '19960101'), 101) AS DATA_ALTERACAO
FROM SD2010 B WITH (NOLOCK)
INNER JOIN SF2010 X WITH (NOLOCK) ON X.F2_DOC = B.D2_DOC
AND X.F2_SERIE = B.D2_SERIE
AND X.F2_FILIAL = B.D2_FILIAL
AND X.F2_CLIENTE = B.D2_CLIENTE
AND X.F2_LOJA = B.D2_LOJA
AND X.F2_EMISSAO = B.D2_EMISSAO
AND X.D_E_L_E_T_ = ''
INNER JOIN SA1010 M WITH (NOLOCK) ON M.A1_COD = B.D2_CLIENTE
AND M.D_E_L_E_T_ = ''
INNER JOIN SB1010 U WITH (NOLOCK) ON U.B1_COD = B.D2_COD
AND U.D_E_L_E_T_ = ''
WHERE B.D2_USERLGI <> ' '
      AND (CONVERT(DATETIME, '1996-01-01', 105) + ((ASCII(SUBSTRING(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGI, 16, 1)) - 50)) >= '20211101'
      AND CONVERT(DATETIME, '1996-01-01', 105) + ((ASCII(SUBSTRING(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGI, 16, 1)) - 50)) <= '20211105'
      OR CONVERT(DATETIME, '1996-01-01', 105) + ((ASCII(SUBSTRING(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGA, 16, 1)) - 50)) >= '20211101'
      AND CONVERT(DATETIME, '1996-01-01', 105) + ((ASCII(SUBSTRING(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTRING(B.D2_USERLGA, 16, 1)) - 50)) <= '20211105')